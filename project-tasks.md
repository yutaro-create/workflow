---
description: スクレイピング実装タスクの詳細分解
phase: tasks
version: 2.0
---

# 実装タスク分解

技術仕様書（design.md）を基に、実装可能な粒度のタスクに分解し、対話的にtasks.mdを作成します。

## 🔐 依存関係定義

```yaml
prerequisites:
  phases:
    - phase: "design"
      status: "approved"
      error_message: "詳細設計が承認されていません"
  documents:
    - path: ".claude/spec/design.md"
      required: true
    - path: ".claude/spec/architecture.md"
      required: false  # オプション
  conditions:
    - design_complete: "phases.design.approval_status == 'approved'"

blocks: []  # 最終フェーズなのでブロックなし
approval_required: true
can_parallel_with: ["test_case_creation"]
```

## 🎯 このフェーズの目的

- 実装タスクの明確化
- 依存関係の整理
- 優先順位の設定
- 工数見積もり
- 実装順序の最適化

## 前提条件チェック

### 実行時

```markdown
🔍 依存関係チェック中...

フェーズ: タスク分解
Check: Phase 1 (要件定義) ✓ 承認済み
Check: Phase 2 (技術調査) ✓ 承認済み
Check: Phase 3 (詳細設計) ✓ 承認済み
Check: design.md ✓ 存在確認
Check: workflow-state.json ✓ 更新済み

→ すべての条件を満たしています

並行実行可能なタスク:
- テストケース作成
```

✅ **Phase 3（詳細設計）が承認済みであること**

承認されていない場合：
```markdown
⚠️ **詳細設計が未承認です**

まず詳細設計を完成させてください：
→ コマンド: /project-design --detailed
```

## 📋 処理フロー

### 1. 設計書の確認

```markdown
📄 **詳細設計書を確認しています...**

確認項目：
- システムアーキテクチャ
- データモデル
- 実装ファイル構成
- エラーハンドリング戦略

[確認完了]
```

### 2. タスク分解フェーズ

```markdown
📦 **タスク分解を開始します**

分解方針:
- 1タスク = 1～2時間の作業
- 各タスクは独立テスト可能
- 明確な完了条件を定義

[分解中...]
```

### 3. 質問フェーズ 🤔

```markdown
📌 **タスク分解に関する確認事項**

以下の点について確認させてください：

### 実装順序について
1. 優先的に実装したい機能は？
   例: 基本的なデータ収集機能

2. ブロッカーになりそうなタスクは？
   例: 外部APIのアクセス権限取得

### リソースについて
3. 各タスクの担当者は決まっていますか？
   例: 全て自分で実装

### テストについて
4. テストの実装タイミングは？
   例: 各タスク完了後すぐにテスト

5. 統合テストの必要性は？
   例: 全タスク完了後にE2Eテスト

📆 **ユーザーアクション必須**
上記の質問にすべて回答してください。
「未定」と答えることも可能です。
```

### 4. タスク一覧の作成

```markdown
📝 **タスク一覧を作成しています...**

作成中:
- Phase 1: 基盤構築 (3タスク)
- Phase 2: コア機能 (3タスク)
- Phase 3: 統合 (2タスク)
- Phase 4: 品質保証 (2タスク)

[作成完了]
```

### 5. ユーザー確認プロセス ✅

```markdown
📄 **実装タスク一覧を作成しました**

場所: `.claude/spec/tasks.md`

## 📦 タスク分解の概要

### フェーズ構成
**Phase 1: 基盤構築** 🎯
- Task-001: ディレクトリ構造作成 (0.5h)
- Task-002: データモデル定義 (1.5h)
- Task-003: 定数定義 (1.0h)

**Phase 2: コア機能** 🔧
- Task-004: パーサー実装 (2.0h)
- Task-005: セッション管理 (1.5h)
- Task-006: データ収集 (2.0h)

**Phase 3: 統合** 🔗
- Task-007: メイン処理 (1.5h)
- Task-008: CLI統合 (1.0h)

**Phase 4: 品質保証** ✅
- Task-009: テスト実装 (2.0h)
- Task-010: ドキュメント作成 (1.0h)

### 統計情報
- **総タスク数**: 10個
- **推定工数**: 13.5時間
- **クリティカルパス**: Task 1 → 2 → 3 → 4 → 7

### 優先順位
🔴 **高**: Task 1, 2, 3, 4, 7
🟡 **中**: Task 5, 6, 8
🟢 **低**: Task 9, 10

---

✅ **このタスク計画で実装を開始しますか？**

選択肢：
1. ✅ **実装開始** → 「実装開始」または「開始」と回答
   → Task-001から順次実装を開始

2. 📝 **調整が必要** → 具体的な調整要望を記載
   → タスクを再編成して再確認

3. ❓ **質問がある** → 追加の質問事項を記載
   → 回答後にタスク一覧を更新

回答をお待ちしています。
```

### 6. 承認後の処理

```markdown
✅ **実装タスク一覧が承認されました！**

承認日時: 2024-XX-XX HH:MM
承認者: [ユーザー名]
ドキュメント: `.claude/spec/tasks.md`

[状態をworkflow-state.jsonに保存中...]
[ワークフロー完了状態を記録...]

🚀 **実装準備完了**

✨ 全てのドキュメントが承認されました！

📁 作成済みドキュメント:
- ✅ requirements.md (要件定義書)
- ✅ design.md (技術仕様書・詳細設計)
- ✅ tasks.md (実装タスク一覧)

📊 プロジェクト統計:
- 完了フェーズ: 4/4
- 回答した質問: XX件
- 作成ドキュメント: 4件
- 定義タスク: XX件
- 推定総工数: XX時間

👤 **次のユーザーアクション**
以下のいずれかを選択してください：
1. 実装を開始: 「実装開始」と入力
2. タスクを確認: `.claude/spec/tasks.md` を参照
3. 特定タスクから開始: `/implement --task 1`

💡 ヒント: 全体の進捗を確認するには `/workflow --status` を使用
```

### 7. ワークフロー完了

統合ワークフローから実行されている場合：

```markdown
========================================
🎉 プロジェクト作成が完了しました！
========================================

プロジェクト: [プロジェクト名]
完了日時: 2024-XX-XX HH:MM
総所要時間: XX時間

👤 **次のユーザーアクション**
以下のいずれかを選択してください：
1. 実装を開始: 「実装開始」と入力
2. tasks.md を確認: `.claude/spec/tasks.md` を参照
3. 特定タスクから開始: `/implement --task 1`

お疲れ様でした！実装頑張ってください 🚀
```

## タスク分解の原則

### 1. タスクの粒度

- 1タスク = 1〜2時間で完了可能な作業
- 各タスクは独立してテスト可能
- 明確な完了条件を持つ

### 2. タスク間の依存関係

```
Phase 1: 基盤構築
├── Task-001: ディレクトリ構造作成
├── Task-002: データモデル定義
└── Task-003: 定数定義

Phase 2: コア機能
├── Task-004: パーサー実装
├── Task-005: セッション管理
└── Task-006: データ収集処理

Phase 3: 統合
├── Task-007: メイン処理
├── Task-008: CLI統合
└── Task-009: エラーハンドリング

Phase 4: 品質保証
└── Task-010: テスト実装
```

## タスク定義テンプレート

`.claude/spec/tasks.md` の構成：

```markdown
# [システム名]実装タスク一覧

## タスク実行順序と依存関係

### フェーズ1: 基盤構築
- Task-001 → Task-002 → Task-003 （並行実行可能）

### フェーズ2: コア機能実装
- Task-004 → Task-005 → Task-006 → Task-007

### フェーズ3: 統合
- Task-008 → Task-009

### フェーズ4: テスト
- Task-010

---

## Task-001: [タスク名]

### 概要
タスクの簡潔な説明

### 実装内容
- 具体的な実装項目
- 作成/修正するファイル

### 参照情報
- **requirements.md**: セクションX.X「項目名」（XX-XX行目）
- **design.md**: セクションY.Y「項目名」（YY-YY行目）
- **参照ファイル**: path/to/reference.py（ZZ-ZZ行目）

### 実装詳細
\```python
# 具体的なコード例やフィールド定義
\```

### 完了条件
- [ ] チェック項目1
- [ ] チェック項目2
- [ ] チェック項目3

---
```

## タスク分解の具体例

### Task-002: データモデルの定義

```markdown
### 概要
pydanticを使用した3つのデータモデルクラスを定義する

### 実装クラス
1. MainEntity - メインエンティティモデル
2. SubEntity - サブエンティティモデル
3. ListPageData - 一覧ページデータモデル

### 参照情報
- **requirements.md**:
  - セクション5.1「エンティティ定義」（81-110行目）
  - セクション5.2「フィールド仕様」（113-126行目）
- **design.md**:
  - セクション2.1「モデル実装」（28-46行目）
  - セクション2.2「バリデーション」（48-88行目）

### 実装詳細

#### MainEntity必須フィールド
\```python
entity_id: str                  # 一意識別子
name: str                        # 名称
created_at: Optional[str]        # 作成日時
scraped_at: str                  # スクレイピング日時（ISO 8601）
\```

### 完了条件
- [ ] 3つのモデルクラスが定義されていること
- [ ] 全フィールドにField()での説明が付与されていること
- [ ] scraped_atフィールドが必須項目として定義されていること
```

## タスク粒度の目安

| タスク種別 | 推奨時間 | ファイル数 |
|-----------|---------|-----------|
| ディレクトリ作成 | 30分 | 5-6 |
| モデル定義 | 1-2時間 | 1 |
| 定数定義 | 1時間 | 1 |
| パーサー実装 | 2-3時間 | 1 |
| セッション管理 | 2時間 | 1 |
| メイン処理 | 2-3時間 | 1 |
| CLI統合 | 30分 | 1 |
| テスト作成 | 2-3時間 | 3 |

## 参照情報の記載ルール

### 1. 行番号の明記

```markdown
### 参照情報
- **requirements.md**: セクション5.1「業者基本情報」（81-110行目）
```

### 2. コード例の引用

```markdown
### 実装詳細
kensetsu/constants.pyの実装パターンを参照：
\```python
class KensetsuConstants(Constant):
    BASE_URL = "https://example.com/"
\```
```

### 3. 既存実装の参照

```markdown
### 参照情報
- **kensetsu/parser.py**: parse_list_page関数（45-67行目）
```

## 完了条件の定義

各タスクに明確な完了条件を定義：

```markdown
### 完了条件
- [ ] ファイルが作成されていること
- [ ] 型ヒントが完全に記述されていること
- [ ] docstringが記述されていること
- [ ] make fmt通過
- [ ] make mypy通過
- [ ] 単体テスト作成（該当する場合）
```

## 最終確認チェックリスト

タスク分解完了後の確認：

```markdown
## 最終確認チェックリスト

### コード品質
- [ ] make fmt通過
- [ ] make mypy通過
- [ ] make test通過

### 機能要件
- [ ] 全データ取得可能
- [ ] エラー時の自動復旧
- [ ] scraped_atフィールドがISO 8601形式

### 固定設定確認
- [ ] 固定パラメータが定数として実装されていること
- [ ] CLIオプションで変更不可であること

### データ統合確認
- [ ] 複数ソースからのデータ統合ルールが実装されていること
```

## タスク実行の推奨事項

### 1. 段階的実装

```bash
# Phase 1: 基盤
Task-001〜003を完了

# Phase 2: コア機能
Task-004〜007を順次実装

# Phase 3: 統合
Task-008〜009で統合

# Phase 4: 品質保証
Task-010でテスト
```

### 2. 継続的検証

```bash
# 各タスク完了後
make fmt
make mypy

# Phase完了後
make test
```

### 3. コミット単位

- 1タスク = 1コミット
- コミットメッセージにタスク番号を含める

```bash
git commit -m "feat: Task-002 データモデル定義を実装"
```

## 注意事項

### 絶対に守るべきルール

1. **固定パラメータは変更不可**
   - 定数として実装
   - CLIオプションで変更できないようにする

2. **文字コード処理**
   - decode時はerrors='ignore'指定

3. **scraped_at必須**
   - utils.datetime.scraped_at()を使用
   - ISO 8601形式で保存

4. **参考実装の踏襲**
   - 既存の実装パターンを踏襲
   - 独自実装は避ける

### タスク分解の品質基準

- [ ] 10個前後のタスクに分解されている
- [ ] 各タスクの依存関係が明確
- [ ] 参照情報が具体的（行番号付き）
- [ ] 完了条件が測定可能
- [ ] 実装者が迷わない詳細度