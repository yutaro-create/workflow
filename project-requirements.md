---
description: プロジェクト要件定義書の対話的作成
phase: requirements
version: 2.0
---

# プロジェクト要件定義書作成

ユーザーの要望を体系的な要件定義書（requirements.md）として文書化し、対話的な確認プロセスを経て完成させます。

## 🔐 依存関係定義

```yaml
prerequisites:
  phases: []  # 最初のフェーズなので前提フェーズなし
  documents: []  # 必須ドキュメントなし
  conditions:
    - project_initialized: true

blocks: ["analysis", "design", "tasks"]
approval_required: true
```

## 🎯 このフェーズの目的

- プロジェクトの目的と範囲を明確化
- 機能要件・非機能要件の整理と文書化
- ステークホルダーとの認識合わせ
- 後続フェーズの基盤となる要件の確定

## 実行方法

```bash
# 直接実行（手動モード）
/project-requirements              # 新規作成
/project-requirements --update     # 質問回答後の更新
/project-requirements --revise     # 承認後の修正

# 統合ワークフローからの実行（推奨）
/workflow "プロジェクト概要"
```

## 前提条件チェック

### 実行時

```markdown
🔍 依存関係チェック中...

フェーズ: 要件定義
Check: プロジェクト初期化 ✓
Check: workflow-state.json ✓

→ すべての条件を満たしています
```

プロジェクトの基本情報が必要：

プロジェクトの基本情報が必要：
- プロダクトの概要と目的
- ターゲットユーザー
- 主要な機能要件
- 制約事項

## 📋 処理フロー

### 1. 初期分析と質問収集

まず、プロジェクトの全体像を把握し、不明確な点を洗い出します：

```markdown
🔍 **初期分析を開始します...**

プロジェクト: [プロジェクト名]
分析対象: 既存ドキュメントと初期要件

[分析中...]
```

### 2. 質問フェーズ 🤔

不明確な点や確認が必要な事項について質問します：

```markdown
📌 **要件定義に関する確認事項があります**

以下の点について確認させてください：

### 機能要件について
1. [具体的な質問1]
   例: ユーザー認証機能は必要ですか？

2. [具体的な質問2]
   例: データのエクスポート機能は必要ですか？

### 非機能要件について
3. [具体的な質問3]
   例: 応答時間の目標値はありますか？

### 制約事項について
4. [具体的な質問4]
   例: 使用必須の技術スタックはありますか？

回答例:
1. はい、OAuth2.0による認証が必要です
2. CSV形式でのエクスポートが必要です
3. APIレスポンスは1秒以内を目標とします
4. Python 3.9以上を使用してください

📌 **ユーザーアクション必須**
上記の質問にすべて回答してください。
不明な点は「未定」と答えることも可能です。
```

### 3. 要件定義書の生成

質問への回答を基に `.claude/spec/requirements.md` を作成：

1. **要件の整理と分類**
   - 機能要件をMoSCoW法で分類
   - 非機能要件を定量的に定義
   - 制約事項を明文化

2. **ドキュメント生成**
   - 構造化された要件定義書を作成
   - 曖昧さを排除した明確な記述
   - トレーサビリティの確保

### 4. ユーザー確認プロセス ✅

作成した要件定義書の確認を求めます：

```markdown
📄 **要件定義書を作成しました**

場所: `.claude/spec/requirements.md`

## 📋 要件定義書の概要

### プロジェクト基本情報
- **プロジェクト名**: [名称]
- **バージョン**: 1.0.0
- **作成日**: 2024-XX-XX

### 機能要件サマリ
**必須機能 (Must Have):**
- ✅ [機能1]
- ✅ [機能2]
- ✅ [機能3]

**追加機能 (Nice to Have):**
- ○ [機能4]
- ○ [機能5]

### 非機能要件サマリ
- **パフォーマンス**: レスポンス1秒以内
- **可用性**: 99.9%
- **セキュリティ**: OAuth2.0認証

### 主な制約事項
- [制約1]
- [制約2]

---

✅ **この内容で問題ありませんか？**

選択肢：
1. ✅ **承認する** → 「承認」または「OK」と回答
   → 次のステップ: 技術調査フェーズ（/project-analysis）へ

2. 📝 **修正が必要** → 具体的な修正内容を記載
   → 要件定義書を修正して再確認

3. ❓ **質問がある** → 追加の質問事項を記載
   → 回答後に要件定義書を更新

回答をお待ちしています。
```

### 5. 承認後の処理

承認を受けたら、次のフェーズへの準備を行います：

```markdown
✅ **要件定義書が承認されました！**

承認日時: 2024-XX-XX HH:MM
承認者: [ユーザー名]
ドキュメント: `.claude/spec/requirements.md`

[状態をworkflow-state.jsonに保存中...]

📊 確定した要件:
- 機能要件: XX件（必須: XX件、追加: XX件）
- 非機能要件: XX件
- 制約事項: XX件

✅ **要件定義書が承認されました！**

👤 **次のユーザーアクション**
技術調査フェーズを開始するには、以下のコマンドを手動で実行してください：
`/project-analysis`

⚠️ このコマンドを実行するまでワークフローは進行しません
```

### 6. フェーズ完了通知

統合ワークフローから実行されている場合：

```markdown
========================================
🎆 Phase 1 完了！
========================================

要件定義が承認されました。

👤 **次のユーザーアクション**
技術調査・分析フェーズを開始するには：
`/project-analysis`

💡 ヒント: 現在の状態を確認するには `/workflow --status` を使用
```

## 🔄 修正・更新プロセス

### 部分的な修正

承認前の修正要求に対応：

```markdown
📝 **修正を反映します**

修正内容:
[ユーザーからの修正要求]

修正対象:
- [x] セクションA を修正
- [x] 要件B を追加
- [x] 制約C を削除

修正を適用中...

完了しました。更新版を確認してください。
```

### 承認後の変更

承認後でも要件変更は可能：

```bash
/project-requirements --revise
```

この場合、変更履歴を記録し、影響分析を実施します。

## 📝 要件定義書のテンプレート構造

作成される `requirements.md` の構造：

```markdown
# [プロジェクト名] 要件定義書

## 1. プロジェクト概要
- 目的
- 背景
- スコープ

## 2. ステークホルダー
- 主要ユーザー
- システム管理者
- その他の関係者

## 3. 機能要件
### 3.1 必須要件（Must Have）
### 3.2 推奨要件（Should Have）
### 3.3 可能要件（Could Have）
### 3.4 将来要件（Won't Have - for now）

## 4. 非機能要件
### 4.1 パフォーマンス
### 4.2 セキュリティ
### 4.3 可用性
### 4.4 保守性
### 4.5 拡張性

## 5. 制約事項
### 5.1 技術的制約
### 5.2 ビジネス制約
### 5.3 法的制約

## 6. 前提条件
## 7. 用語定義
## 8. 承認記録
```

## 📊 進捗追跡

### 質問回答状況

```markdown
📊 **質問回答ステータス**

全質問数: 8
回答済み: 6 ✅
未回答: 2 ⏸️

未回答の質問:
- 質問3: パフォーマンス要件
- 質問7: バックアップ要件

完了率: 75%
```

## 🎯 ベストプラクティス

1. **段階的詳細化**
   - 最初は大まかな要件から始める
   - 質問と回答を通じて詳細化

2. **明確な言語使用**
   - 「〜すること」「〜できること」で要件を記述
   - 曖昧な表現（たぶん、おそらく）を避ける

3. **トレーサビリティ**
   - 各要件に識別番号を付与
   - 要件間の関連を明記

4. **変更管理**
   - すべての変更を記録
   - 変更の影響を分析

## 📚 関連ドキュメント

- [ワークフロー全体](./workflow.md)
- [質問テンプレート](./questions-template.md)
- [次フェーズ: 技術調査](./project-analysis.md)

2. 修正要望 → 具体的な修正内容を記述
   → 要件定義書を修正して再確認

3. 不明点・追加質問 → 「〇〇について詳しく決めたい」
   → 質問書を生成します
```

### 3. 質問書の生成（必要時）

ユーザーから不明点や詳細化の要望があった場合：

1. **質問書の作成**
   - `.claude/spec/requirements-questions.md` を生成
   - プロジェクトタイプに応じた質問テンプレートを適用

2. **回答収集**
   ```
   📄 質問書を作成しました
      場所: .claude/spec/requirements-questions.md

   質問書に回答を記入後、以下のコマンドを実行してください：
   /project-requirements --update
   ```

3. **要件定義書の更新**
   - 回答内容を反映して requirements.md を更新
   - 再度ユーザー確認プロセスへ

## 要件定義書の構成

```markdown
# [プロジェクト名]要件定義書

## 1. プロダクト概要
### 1.1 背景と目的
- なぜこのプロダクトが必要か
- どんな課題を解決するか
- 期待される効果

### 1.2 スコープ
- 対象範囲
- 対象外とする範囲
- 将来的な拡張計画

## 2. ステークホルダー
### 2.1 ユーザー
- プライマリユーザー
- セカンダリユーザー
- ユーザーストーリー

### 2.2 関係者
- プロダクトオーナー
- 開発チーム
- 運用チーム

## 3. 機能要件
### 3.1 ユースケース
- アクター
- 基本フロー
- 代替フロー
- 例外フロー

### 3.2 機能一覧（MoSCoW分類）
| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| F001   | ユーザー登録 | Must | メールアドレスでの新規登録 |
| F002   | ログイン | Must | メール/パスワード認証 |

### 3.3 画面/インターフェース
- 画面遷移図
- ワイヤーフレーム（概要）
- API エンドポイント一覧

## 4. 非機能要件
### 4.1 パフォーマンス
- レスポンスタイム: 95%tile < 200ms
- スループット: 1000 req/sec
- データベースサイズ: 初年度 100GB想定

### 4.2 セキュリティ
- 認証方式: JWT/OAuth2
- 通信暗号化: HTTPS必須
- データ暗号化: 個人情報は暗号化

### 4.3 可用性
- 稼働率: 99.9%（月間43分以内の停止）
- バックアップ: 日次自動バックアップ
- DR対策: マルチリージョン構成

### 4.4 保守性
- ログレベル: INFO以上を記録
- 監視項目: CPU, メモリ, ディスク, レスポンスタイム
- デプロイ頻度: 週1回以上可能

## 5. 制約事項
### 5.1 技術的制約
### 5.2 ビジネス制約
### 5.3 法的制約

## 6. データ要件
### 6.1 データモデル
### 6.2 データ量

## 7. 外部インターフェース
### 7.1 連携システム
### 7.2 データ連携

## 8. 移行要件（既存システムがある場合）

## 9. 成功基準
### 9.1 定量的指標
### 9.2 定性的指標

## 10. リスクと対策
```

## 質問テンプレート

### プロジェクトタイプ別の追加質問例

**Webアプリケーション**:
```markdown
# 要件定義に関する追加質問

## 認証・セキュリティ
### Q1: ソーシャルログインは必要ですか？
【回答】

### Q2: 多要素認証（2FA）を実装しますか？
【回答】

## UI/UX
### Q3: レスポンシブ対応の優先度は？
【回答】
- [ ] スマートフォン最優先
- [ ] タブレット対応も必須
- [ ] デスクトップのみで十分

## SEO要件
### Q4: SEO対策の重要度は？
【回答】
```

**モバイルアプリ**:
```markdown
# 要件定義に関する追加質問

## プラットフォーム
### Q1: 対応OSのバージョン範囲は？
【回答】
- iOS:
- Android:

## オフライン機能
### Q2: オフラインでの動作要件は？
【回答】
```

**APIサービス**:
```markdown
# 要件定義に関する追加質問

## API仕様
### Q1: APIドキュメントの自動生成（OpenAPI等）は必要ですか？
【回答】

## レート制限
### Q2: API利用制限の設定は？
【回答】
- 1分あたりの上限:
- 1日あたりの上限:
```

## 品質基準

要件定義書の完成基準：

- [ ] すべての機能要件に優先度（MoSCoW）が設定されている
- [ ] 非機能要件が定量的に定義されている
- [ ] ステークホルダー全員が内容を理解できる記述
- [ ] 実装可能性が技術的に検証されている
- [ ] テスト可能な要件として記述されている
- [ ] ユーザーからの承認を得ている

## 実行例

```bash
# 新規プロジェクトの要件定義
User: /project-requirements

Claude:
📄 要件定義書を作成しました
   場所: .claude/spec/requirements.md

## 概要
- プロダクト: ECサイト
- 主要機能: 商品管理、カート、決済
- ターゲット: 20-40代女性

✅ この内容で問題ありませんか？

User: 決済方法について詳しく決めたい

Claude:
📄 質問書を作成しました
   場所: .claude/spec/requirements-questions.md

以下の質問に回答してください：
- Q1: 対応する決済方法は？
- Q2: サブスクリプション機能は必要ですか？
- Q3: 返金処理の要件は？

回答後、`/project-requirements --update` を実行してください。

# 質問回答後の更新
User: /project-requirements --update

Claude:
📄 要件定義書を更新しました
   決済方法: クレジットカード、PayPay、コンビニ決済

✅ この内容で問題ありませんか？

User: 承認します

Claude:
✅ 要件定義書が承認されました。
次のステップ: `/project-analysis` で技術調査を実行してください。
```

## 次のステップ

要件定義書が承認された後：

1. **技術調査と分析**: `/project-analysis`
   - 要件に基づく技術スタックの選定
   - 実現可能性の検証

2. **必要に応じた要件の見直し**
   - 技術的制約が判明した場合
   - 予算やスケジュールの制約が明確になった場合

## 注意事項

- **曖昧さの排除**: 「できるだけ速く」「使いやすい」などの曖昧な表現を避ける
- **実装方法の分離**: 要件定義では「何を」に集中し、「どのように」は設計フェーズで
- **ユーザー承認の重要性**: 承認なしに次のフェーズへ進まない
- **柔軟な修正**: ユーザーの要望に応じていつでも修正可能
- **継続的な更新**: プロジェクト進行中も必要に応じて更新