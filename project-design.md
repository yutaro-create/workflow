---
description: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®æŠ€è¡“ä»•æ§˜æ›¸ä½œæˆ
phase: design
version: 2.0
---

# æŠ€è¡“ä»•æ§˜æ›¸ä½œæˆ

è¦ä»¶å®šç¾©æ›¸ï¼ˆrequirements.mdï¼‰ã¨æŠ€è¡“åˆ†æçµæœã‚’åŸºã«ã€å®Ÿè£…å¯èƒ½ãªæŠ€è¡“ä»•æ§˜æ›¸ï¼ˆdesign.mdï¼‰ã‚’å¯¾è©±çš„ã«ä½œæˆã—ã¾ã™ã€‚

## ğŸ” ä¾å­˜é–¢ä¿‚å®šç¾©

```yaml
prerequisites:
  phases:
    - phase: "requirements"
      status: "approved"
    - phase: "analysis"
      status: "approved"
      error_message: "æŠ€è¡“èª¿æŸ»ãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“"
  documents:
    - path: ".claude/spec/requirements.md"
      required: true
    - path: ".claude/spec/tech-analysis.md"
      required: true
  conditions:
    - tech_stack_defined: "project.tech_stack != null"

blocks: ["tasks", "implementation"]
approval_required: true
can_parallel_with: ["test_planning", "documentation"]
```

## ğŸ¯ ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã®ç›®çš„

- ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è©³ç´°è¨­è¨ˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®å®šç¾©
- API/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜ã®æ˜ç¢ºåŒ–
- å®Ÿè£…æ–¹é‡ã®è©³ç´°åŒ–
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥ã®ç­–å®š

## å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯

### å®Ÿè¡Œæ™‚

```markdown
ğŸ” ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ä¸­...

ãƒ•ã‚§ãƒ¼ã‚º: è©³ç´°è¨­è¨ˆ
Check: Phase 1 (è¦ä»¶å®šç¾©) âœ“ æ‰¿èªæ¸ˆã¿
Check: Phase 2 (æŠ€è¡“èª¿æŸ») âœ“ æ‰¿èªæ¸ˆã¿
Check: requirements.md âœ“ å­˜åœ¨ç¢ºèª
Check: tech-analysis.md âœ“ å­˜åœ¨ç¢ºèª
Check: workflow-state.json âœ“ æ›´æ–°æ¸ˆã¿

â†’ ã™ã¹ã¦ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã™

ä¸¦è¡Œå®Ÿè¡Œå¯èƒ½ãªã‚¿ã‚¹ã‚¯:
- ãƒ†ã‚¹ãƒˆè¨ˆç”»ä½œæˆ
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
```

âœ… **Phase 2ï¼ˆæŠ€è¡“èª¿æŸ»ï¼‰ãŒæ‰¿èªæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨**

æ‰¿èªã•ã‚Œã¦ã„ãªã„å ´åˆï¼š
```markdown
âš ï¸ **æŠ€è¡“èª¿æŸ»ãŒæœªæ‰¿èªã§ã™**

ã¾ãšæŠ€è¡“èª¿æŸ»ã‚’å®Œæˆã•ã›ã¦ãã ã•ã„ï¼š
â†’ ã‚³ãƒãƒ³ãƒ‰: /project-analysis
```

## ğŸ“‹ å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 1. æŠ€è¡“ä»•æ§˜ã®ç¢ºèª

```markdown
ğŸ“„ **æŠ€è¡“ä»•æ§˜ã‚’ç¢ºèªã—ã¦ã„ã¾ã™...**

ç¢ºèªé …ç›®ï¼š
- é¸å®šã—ãŸæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- API/HTMLæ§‹é€ åˆ†æçµæœ
- å‚ç…§å®Ÿè£…ã®ç¢ºèªçŠ¶æ³

[ç¢ºèªå®Œäº†]
```

### 2. è©³ç´°è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚º

```markdown
ğŸ”¨ **è©³ç´°è¨­è¨ˆã‚’é–‹å§‹ã—ã¾ã™**

è¨­è¨ˆå¯¾è±¡:
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ‡ãƒ¼ã‚¿ä¿å­˜ä»•æ§˜

[è¨­è¨ˆä¸­...]
```

### 3. è³ªå•ãƒ•ã‚§ãƒ¼ã‚º ğŸ¤”

```markdown
ğŸ“Œ **è©³ç´°è¨­è¨ˆã«é–¢ã™ã‚‹ç¢ºèªäº‹é …ãŒã‚ã‚Šã¾ã™**

ä»¥ä¸‹ã®ç‚¹ã«ã¤ã„ã¦ç¢ºèªã•ã›ã¦ãã ã•ã„ï¼š

### ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°è¨­è¨ˆã«ã¤ã„ã¦
1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã¯ï¼Ÿ
   ä¾‹: 30åˆ†ã€è‡ªå‹•å†åˆæœŸåŒ–

2. ãƒªãƒˆãƒ©ã‚¤å›æ•°ã®ä¸Šé™ã¯ï¼Ÿ
   ä¾‹: æœ€å¤§3å›ã¾ã§

### ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã«ã¤ã„ã¦
3. é‡è¤‡ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†æ–¹é‡ã¯ï¼Ÿ
   ä¾‹: ä¸Šæ›¸ãã€ã‚¹ã‚­ãƒƒãƒ—ã€ãƒãƒ¼ã‚¸

4. ãƒ‡ãƒ¼ã‚¿ä¿å­˜å½¢å¼ã¯ï¼Ÿ
   ä¾‹: JSONï¼ˆã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚ã‚Šï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã¤ã„ã¦
5. ä¸¦åˆ—å‡¦ç†ã®å¿…è¦æ€§ã¯ï¼Ÿ
   ä¾‹: 10ä»¶ãšã¤ä¸¦åˆ—å‡¦ç†

ğŸ“† **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¿…é ˆ**
ä¸Šè¨˜ã®è³ªå•ã«ã™ã¹ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚
ã€Œæœªå®šã€ã¨ç­”ãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
```

### 4. è©³ç´°è¨­è¨ˆæ›¸ã®ä½œæˆ

```markdown
ğŸ“ **è©³ç´°è¨­è¨ˆæ›¸ã‚’ä½œæˆã—ã¦ã„ã¾ã™...**

ä½œæˆä¸­ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼š
- ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ä»•æ§˜
- ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…ä»•æ§˜
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥
- ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

[ä½œæˆå®Œäº†]
```

### 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªãƒ—ãƒ­ã‚»ã‚¹ âœ…

```markdown
ğŸ“„ **è©³ç´°è¨­è¨ˆæ›¸ã‚’å®Œæˆã•ã›ã¾ã—ãŸ**

å ´æ‰€: `.claude/spec/design.md`

## ğŸ—ï¸ è¨­è¨ˆã®æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ:**
```
premiumsegment/[ã‚·ã‚¹ãƒ†ãƒ å]/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ models.py      # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ constants.py   # å®šæ•°å®šç¾©
â”œâ”€â”€ parser.py      # HTMLãƒ‘ãƒ¼ã‚µãƒ¼
â””â”€â”€ main.py        # ãƒ¡ã‚¤ãƒ³å‡¦ç†
```

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
**ä¸»è¦ãƒ¢ãƒ‡ãƒ«:**
- `MainEntity`: ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- `SubEntity`: ã‚µãƒ–ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- `ListPageData`: ä¸€è¦§ãƒšãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿

### å®Ÿè£…æ–¹é‡
**ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†:**
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 30åˆ†
- è‡ªå‹•å†åˆæœŸåŒ–æ©Ÿèƒ½

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:**
- æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
- æœ€å¤§3å›ãƒªãƒˆãƒ©ã‚¤

---

âœ… **ã“ã®è¨­è¨ˆã§å®Ÿè£…ã‚’é–‹å§‹ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ**

é¸æŠè‚¢ï¼š
1. âœ… **æ‰¿èªã™ã‚‹** â†’ ã€Œæ‰¿èªã€ã¾ãŸã¯ã€ŒOKã€ã¨å›ç­”
   â†’ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ•ã‚§ãƒ¼ã‚ºã¸

2. ğŸ“ **èª¿æ•´ãŒå¿…è¦** â†’ å…·ä½“çš„ãªèª¿æ•´è¦æœ›ã‚’è¨˜è¼‰
   â†’ è¨­è¨ˆã‚’ä¿®æ­£ã—ã¦å†ç¢ºèª

3. â“ **è³ªå•ãŒã‚ã‚‹** â†’ è¿½åŠ ã®è³ªå•äº‹é …ã‚’è¨˜è¼‰
   â†’ å›ç­”å¾Œã«è¨­è¨ˆæ›¸ã‚’æ›´æ–°

å›ç­”ã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€‚
```

### 6. æ‰¿èªå¾Œã®å‡¦ç†

```markdown
âœ… **è©³ç´°è¨­è¨ˆæ›¸ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸï¼**

æ‰¿èªæ—¥æ™‚: 2024-XX-XX HH:MM
æ‰¿èªè€…: [ãƒ¦ãƒ¼ã‚¶ãƒ¼å]
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: `.claude/spec/design.md`

[çŠ¶æ…‹ã‚’workflow-state.jsonã«ä¿å­˜ä¸­...]

ğŸ“Š ç¢ºå®šã—ãŸè¨­è¨ˆ:
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£: [ç¢ºå®š]
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«: XXå€‹
- å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«: XXå€‹
- ãƒ†ã‚¹ãƒˆæˆ¦ç•¥: [ç¢ºå®š]

âœ… **è©³ç´°è¨­è¨ˆæ›¸ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸï¼**

ğŸ‘¤ **æ¬¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**
ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ•ã‚§ãƒ¼ã‚ºã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰‹å‹•ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
`/project-tasks`

âš ï¸ ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¾ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯é€²è¡Œã—ã¾ã›ã‚“
```

### 7. è‡ªå‹•ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»

çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆï¼š

```markdown
========================================
ğŸ† Phase 3 å®Œäº†ï¼
========================================

è©³ç´°è¨­è¨ˆãŒæ‰¿èªã•ã‚Œã¾ã—ãŸã€‚

ğŸ‘¤ **æ¬¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**
ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ•ã‚§ãƒ¼ã‚ºã‚’é–‹å§‹ã™ã‚‹ã«ã¯ï¼š
`/project-tasks`

ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ `/workflow --status` ã‚’ä½¿ç”¨
```

## ä½œæˆæ‰‹é †

### 1. æŠ€è¡“ä»•æ§˜æ›¸ã®æ§‹æˆ

`.claude/spec/design.md` ã‚’ä»¥ä¸‹ã®æ§‹æˆã§ä½œæˆï¼š

```markdown
# [ã‚·ã‚¹ãƒ†ãƒ å]æŠ€è¡“ä»•æ§˜æ›¸

## 1. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
### 1.1 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
### 1.2 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ä»•æ§˜ (models.py)
### 2.1 ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
### 2.2 ã‚µãƒ–ãƒ¢ãƒ‡ãƒ«
### 2.3 ãƒªã‚¹ãƒˆãƒšãƒ¼ã‚¸ãƒ¢ãƒ‡ãƒ«

## 3. å®šæ•°å®šç¾© (constants.py)
### 3.1 å®šæ•°ã‚¯ãƒ©ã‚¹

## 4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†å®Ÿè£…
### 4.1 SessionManagerã‚¯ãƒ©ã‚¹

## 5. ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£… (parser.py)
### 5.1 ä¸€è¦§ãƒšãƒ¼ã‚¸ãƒ‘ãƒ¼ã‚µãƒ¼
### 5.2 è©³ç´°ãƒšãƒ¼ã‚¸ãƒ‘ãƒ¼ã‚µãƒ¼
### 5.3 ãƒ‡ãƒ¼ã‚¿çµ±åˆå‡¦ç†

## 6. ãƒ¡ã‚¤ãƒ³å‡¦ç†å®Ÿè£… (main.py)
### 6.1 å…¨ä½“ãƒ•ãƒ­ãƒ¼
### 6.2 ãƒ‡ãƒ¼ã‚¿åé›†å‡¦ç†
### 6.3 ãƒ‡ãƒ¼ã‚¿ä¿å­˜å‡¦ç†

## 7. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥
### 7.1 ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
### 7.2 ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼å‡¦ç†

## 8. ãƒ‡ãƒ¼ã‚¿ä¿å­˜ä»•æ§˜
### 8.1 ä¿å­˜ãƒ‘ã‚¹æ§‹æˆ
### 8.2 ä¿å­˜å‡¦ç†

## 9. CLIçµ±åˆ
### 9.1 ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ

## 10. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
### 10.1 å˜ä½“ãƒ†ã‚¹ãƒˆ
### 10.2 çµ±åˆãƒ†ã‚¹ãƒˆ

## 11. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
### 11.1 ä¸¦åˆ—å‡¦ç†
### 11.2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

## 12. ç›£è¦–ã¨ãƒ­ã‚°
### 12.1 é€²æ—ãƒ­ã‚°
### 12.2 ã‚¨ãƒ©ãƒ¼é€šçŸ¥

## 13. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
### 13.1 ãƒ¬ãƒ¼ãƒˆåˆ¶é™
### 13.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·

## 14. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
### 14.1 ç’°å¢ƒå¤‰æ•°
### 14.2 å®Ÿè¡Œä¾‹

## 15. å®Œäº†åŸºæº–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
```

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©

#### 2.1 pydanticãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…ä¾‹

```python
from typing import Optional, List
from pydantic import BaseModel, Field
from datetime import datetime

class MainEntity(BaseModel):
    """ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£"""
    id: str = Field(..., description="ä¸€æ„è­˜åˆ¥å­")
    name: str = Field(..., description="åç§°")
    created_at: Optional[str] = Field(None, description="ä½œæˆæ—¥æ™‚")
    scraped_at: str = Field(..., description="ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æ—¥æ™‚ï¼ˆISO 8601ï¼‰")

    class Config:
        json_encoders = {
            datetime: lambda v: v.isoformat()
        }
```

#### 2.2 å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

ã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«ã«å«ã‚ã‚‹ã¹ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼š

```python
scraped_at: str = Field(..., description="ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æ—¥æ™‚ï¼ˆISO 8601ï¼‰")
```

### 3. å®šæ•°å®šç¾©ã®å®Ÿè£…

#### 3.1 Constantã‚¯ãƒ©ã‚¹ã®ç¶™æ‰¿

```python
from utils.constant import Constant
from typing import Dict

class SiteConstants(Constant):
    """ã‚µã‚¤ãƒˆå›ºæœ‰ã®å®šæ•°å®šç¾©"""

    # URLè¨­å®š
    BASE_URL = "https://example.com/"
    SEARCH_URL = f"{BASE_URL}search"

    # å›ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå¤‰æ›´ä¸å¯ï¼‰
    FIXED_PARAMS = {
        "mode": "search",
        "type": "all"
    }

    # HTMLã‚»ãƒ¬ã‚¯ã‚¿
    TABLE_SELECTOR = "table.results"

    # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
    DEFAULT_TIMEOUT = 30
    SESSION_TIMEOUT = 1800  # 30åˆ†
```

### 4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®å®Ÿè£…

#### 4.1 SessionManagerãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```python
import requests
from datetime import datetime, timedelta
from typing import Optional

class SessionManager:
    """ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚¯ãƒ©ã‚¹"""

    def __init__(self):
        self.session = requests.Session()
        self.last_access = None
        self.session_id = None

    def initialize_session(self) -> bool:
        """ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–"""
        # 1. ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹
        # 2. æ¤œç´¢ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        # 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³IDä¿å­˜
        pass

    def is_session_valid(self) -> bool:
        """ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯"""
        pass

    def ensure_session(self) -> bool:
        """ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºä¿"""
        pass

    def post_request(self, url: str, data: dict) -> Optional[requests.Response]:
        """POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ"""
        pass
```

### 5. ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### 5.1 å…±é€šå‡¦ç†

```python
from bs4 import BeautifulSoup
import re
from typing import List, Dict, Optional

def sanitize_text(text: str) -> str:
    """ãƒ†ã‚­ã‚¹ãƒˆã‚µãƒ‹ã‚¿ã‚¤ã‚º"""
    return text.strip().replace('\u3000', ' ').replace('\xa0', ' ')

def safe_extract(element, selector: str, default: str = "") -> str:
    """å®‰å…¨ãªè¦ç´ æŠ½å‡º"""
    target = element.select_one(selector)
    return sanitize_text(target.text) if target else default
```

#### 5.2 ãƒ‘ãƒ¼ã‚µãƒ¼é–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```python
def parse_list_page(html: str) -> ListPageData:
    """ä¸€è¦§ãƒšãƒ¼ã‚¸ãƒ‘ãƒ¼ã‚¹"""
    soup = BeautifulSoup(html, "html.parser")
    data = ListPageData()

    # ç·ä»¶æ•°
    # IDæŠ½å‡º
    # ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³

    return data

def parse_detail_page(soup: BeautifulSoup) -> dict:
    """è©³ç´°ãƒšãƒ¼ã‚¸ãƒ‘ãƒ¼ã‚¹"""
    data = {}

    # å„ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰æƒ…å ±æŠ½å‡º
    # ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°

    return data
```

### 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

#### 6.1 ãƒªãƒˆãƒ©ã‚¤ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿

```python
from functools import wraps
import asyncio

def retry_on_error(max_retries=3, delay=2):
    """ãƒªãƒˆãƒ©ã‚¤ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿"""
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            last_exception = None

            for attempt in range(max_retries):
                try:
                    return await func(*args, **kwargs)
                except Exception as e:
                    last_exception = e
                    if attempt < max_retries - 1:
                        wait_time = delay * (2 ** attempt)  # exponential backoff
                        await asyncio.sleep(wait_time)

            raise last_exception

        return wrapper
    return decorator
```

### 7. ãƒ‡ãƒ¼ã‚¿ä¿å­˜å®Ÿè£…

#### 7.1 ä¿å­˜ãƒ‘ã‚¹æ§‹æˆ

```python
def get_save_path(entity_type: str, entity_id: str, prefix: str = "") -> str:
    """ä¿å­˜ãƒ‘ã‚¹ç”Ÿæˆ"""
    # companies/site_name/{prefecture}/{id}.json
    # joboffers/site_name/{id}.json
    return f"{entity_type}/{site_name}/{prefix}/{entity_id}.json"
```

#### 7.2 ä¿å­˜å‡¦ç†

```python
async def save_entity(storage: StorageInterface, entity: BaseModel, path: str) -> bool:
    """ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä¿å­˜"""
    try:
        json_data = entity.model_dump_json(
            ensure_ascii=False,
            indent=2
        )
        await storage.put(path, json_data)
        return True
    except Exception as e:
        logger.error(f"ä¿å­˜ã‚¨ãƒ©ãƒ¼: {e}")
        return False
```

### 8. CLIçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³

```python
@click.command()
@click.option("--local", is_flag=True, help="ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨")
@click.option("--test-limit", type=int, help="ãƒ†ã‚¹ãƒˆç”¨ä»¶æ•°åˆ¶é™")
def site_name(local, test_limit):
    """ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°"""
    from premiumsegment.site_name.main import main

    storage = LocalStorage() if local else S3Storage()

    asyncio.run(
        main(
            storage=storage,
            test_limit=test_limit
        )
    )
```

## å“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å¿…é ˆå®Ÿè£…é …ç›®

- [ ] scraped_at()é–¢æ•°ã®ä½¿ç”¨ï¼ˆutils/datetime.pyï¼‰
- [ ] Resultå‹ã®ä½¿ç”¨ï¼ˆutils/result.pyï¼‰
- [ ] StorageInterfaceã®ä½¿ç”¨
- [ ] æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‡¦ç†
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¯¾ç­–
- [ ] exponential backoffãƒªãƒˆãƒ©ã‚¤

### ã‚³ãƒ¼ãƒ‰å“è³ª

- [ ] å‹ãƒ’ãƒ³ãƒˆã®å®Œå…¨ãªè¨˜è¿°
- [ ] docstringã®è¨˜è¿°
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ãƒ­ã‚°å‡ºåŠ›

## å‚ç…§å®Ÿè£…

æ—¢å­˜å®Ÿè£…ã®å‚ç…§ï¼š

```bash
# å»ºè¨­æ¥­è€…ã®æŠ€è¡“ä»•æ§˜
cat premiumsegment/kensetsu/.claude/spec/design.md

# å®…å»ºã®æŠ€è¡“ä»•æ§˜
cat premiumsegment/takuchi/.claude/spec/design.md

# å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
ls -la utils/
```

## å®Ÿè£…é †åºã®æ¨å¥¨

1. models.py - ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©
2. constants.py - å®šæ•°å®šç¾©
3. parser.py - ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…
4. main.py - ãƒ¡ã‚¤ãƒ³å‡¦ç†ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
5. CLIçµ±åˆ
6. ãƒ†ã‚¹ãƒˆä½œæˆ

## æ³¨æ„äº‹é …

- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¸è¥²ã™ã‚‹ã“ã¨
- å›ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å®šæ•°ã¨ã—ã¦å®šç¾©ã—ã€å¤‰æ›´ä¸å¯ã¨ã™ã‚‹ã“ã¨
- æ–‡å­—ã‚³ãƒ¼ãƒ‰å¤‰æ›ã¯å¿…ãšerrors='ignore'ã‚’æŒ‡å®šã™ã‚‹ã“ã¨
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¯30åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å‰æã¨ã™ã‚‹ã“ã¨